apiVersion: secrets.infisical.com/v1alpha1
kind: InfisicalSecret
metadata:
  name: infisicalsecret
  namespace: infisical-secrets-operator
spec:
  hostAPI: https://eu.infisical.com/api
  resyncInterval: 10
  authentication:
    universalAuth:
      secretsScope:
        projectSlug: homelab-graz
        envSlug: prod
        secretsPath: "/"
      credentialsRef:
        secretName: universal-auth-credentials
        secretNamespace: infisical-secrets-operator
  managedKubeSecretReferences:
    - secretName: managed-secret
      secretNamespace: infisical-secrets-operator
      creationPolicy: "managed"
    - secretName: cloudflare-api-token
      secretNamespace: traefik
      creationPolicy: "managed"
      template:
        includeAllSecrets: false
        data:
          CF_DNS_API_TOKEN: "{{ .CLOUDFLARE_API_KEY.Value }}"
    - secretName: docker-pull-secret
      secretNamespace: portfolio
      secretType: kubernetes.io/dockerconfigjson
      creationPolicy: "managed"
      template:
        includeAllSecrets: false
        data:
          .dockerconfigjson: "{{ .DOCKER_PULL_SECRET.Value }}"
    - secretName: cloudflare-tunnel-secret
      secretNamespace: traefik
      creationPolicy: "cloudflared"
      template:
        includeAllSecrets: false
        data:
          CF_ACCOUNT: "{{ .CLOUDFLARE_ACCOUNT_ID.Value }}"
          CF_TUNNEL_TOKEN: "{{ .CLOUDFLARE_TUNNEL_SECRET.Value }}"
